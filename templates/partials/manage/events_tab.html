{% load static %}
{# Events Tab Content #}
<div class="tab-panel" id="events">
  <div class="tab-header">
    <h2>Events</h2>
    <p>Manage church events and special occasions</p>
  </div>
  
  <div class="tab-content">
    <div class="posts-management">
      <div class="posts-header">
        <div class="posts-stats">
          <div class="stat-item">
            <span class="stat-number">{{ event_posts_count }}</span>
            <span class="stat-label">Total Events</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ follower_count }}</span>
            <span class="stat-label">Followers</span>
          </div>
        </div>
        <button type="button" class="btn btn-primary" onclick="openEventCreationModal()">
          {% include 'partials/icons/plus.html' %}
          Create New Event
        </button>
      </div>

      {% if event_posts %}
        <div class="posts-list">
          {% for post in event_posts %}
            {% include 'partials/manage/post_card.html' with post=post church=church %}
          {% endfor %}
        </div>
        
        {% if event_posts_count > 20 %}
          <div class="posts-pagination">
            <p class="text-muted">Showing 20 of {{ event_posts_count }} event posts</p>
          </div>
        {% endif %}
      {% else %}
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <h3>No Events Scheduled</h3>
          <p>Create event posts to share upcoming church activities and special occasions with your community.</p>
          <button type="button" class="btn btn-primary" onclick="openEventCreationModal()">
            {% include 'partials/icons/plus.html' %}
            Create Event Post
          </button>
        </div>
      {% endif %}
    </div>
  </div>
  
  <!-- Event Creation Modal -->
  <div id="eventsCreatePostModal" class="post-modal modal-overlay" style="display: none;">
    <div class="post-modal-content modal-content">
      <div class="post-modal-header modal-header">
        <h3 class="post-modal-title">Create Event</h3>
        <button type="button" class="post-modal-close modal-close" onclick="hideEventCreationModal()">&times;</button>
      </div>
      
      <form id="eventsCreatePostForm" class="post-creation-form" method="post" action="{% url 'core:dashboard_create_post' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="church_id" value="{{ church.id }}">
        <input type="hidden" name="post_type" value="event">
        
        <!-- Event Title -->
        <div class="form-group">
          <label for="events-event-title" class="form-label">Event Title <span class="required">*</span></label>
          <input type="text" id="events-event-title" name="event_title" class="form-input event-input" placeholder="Enter event title..." maxlength="200" required>
        </div>
        
        <!-- Event Date & Time -->
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="events-event-start-date" class="form-label">Start Date & Time <span class="required">*</span></label>
            <input type="datetime-local" id="events-event-start-date" name="event_start_date" class="form-input event-input" required>
          </div>
          
          <div class="form-group form-group-half">
            <label for="events-event-end-date" class="form-label">End Date & Time <span class="required">*</span></label>
            <input type="datetime-local" id="events-event-end-date" name="event_end_date" class="form-input event-input" required>
          </div>
        </div>
        
        <!-- Event Location -->
        <div class="form-group">
          <label for="events-event-location" class="form-label">Location (Optional)</label>
          <input type="text" id="events-event-location" name="event_location" class="form-input event-input" placeholder="Event venue or address" maxlength="300">
        </div>
        
        <!-- Max Participants -->
        <div class="form-group">
          <label for="events-max-participants" class="form-label">Maximum Participants (Optional)</label>
          <input type="number" id="events-max-participants" name="max_participants" class="form-input event-input" placeholder="Leave blank for unlimited" min="1" max="10000">
          <small class="form-help-text">Set a limit on how many people can participate in this event</small>
        </div>
        
        <!-- Content/Description -->
        <div class="form-group">
          <label for="events-post-content" class="form-label">Event Description <span class="required">*</span></label>
          <textarea 
            id="events-post-content"
            name="content" 
            class="post-textarea" 
            placeholder="Describe your event..."
            maxlength="1000"
            rows="4"
            required
          ></textarea>
          <div class="character-count">
            <span id="events-char-count">0</span>/1000
          </div>
        </div>
        
        <!-- Multiple Image Upload -->
        <div class="form-group">
          <div class="image-upload-area">
            <input type="file" id="events-post-images" name="images" accept="image/*" multiple class="file-input">
            <label for="events-post-images" class="file-upload-label">
              <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <path d="M21 15l-5-5L5 21"/>
              </svg>
              <span class="upload-text">Click to add photos (up to 10)</span>
              <span class="upload-hint">You can select multiple images</span>
            </label>
            <div id="events-images-preview" class="images-preview-container" style="display: none;">
              <!-- Image previews will be added here dynamically -->
            </div>
          </div>
        </div>
        
        <!-- Donation Toggle -->
        <div class="form-group donation-toggle-section">
          <div class="toggle-wrapper">
            <input type="checkbox" id="events-enable-donation" name="enable_donation" class="toggle-input" 
                   data-has-paypal="{% if church.paypal_email %}true{% else %}false{% endif %}">
            <label for="events-enable-donation" class="toggle-label">
              <svg class="donation-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
              </svg>
              <span>Enable Donations for this event</span>
            </label>
          </div>
          {% if not church.paypal_email %}
          <div class="donation-warning" style="margin-top: 0.5rem; padding: 0.75rem; background: #fffbeb; border: 1px solid #fde68a; border-radius: 6px; display: flex; align-items: flex-start; gap: 0.5rem;">
            <svg style="width: 16px; height: 16px; color: #f59e0b; flex-shrink: 0; margin-top: 2px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            <div style="font-size: 0.875rem; color: #92400e; line-height: 1.5;">
              <strong>Payment setup required:</strong> Set up your PayPal email in <a href="{% url 'core:manage_church' church.id %}?tab=settings" style="color: #92400e; text-decoration: underline; font-weight: 600;">Church Settings → Payment Settings</a> to enable donations.
            </div>
          </div>
          {% endif %}
        </div>
        
        <!-- Donation Goal (Hidden by default) -->
        <div id="events-donation-fields" class="donation-fields" style="display: none;">
          <div class="form-group">
            <label for="events-donation-goal" class="form-label">Donation Goal (Optional)</label>
            <div class="input-with-prefix">
              <span class="input-prefix">₱</span>
              <input type="number" id="events-donation-goal" name="donation_goal" class="form-input" 
                     placeholder="0.00" min="0" step="0.01">
            </div>
            <small class="form-hint">Leave empty for no specific goal</small>
          </div>
        </div>
        
        <!-- Submit Button -->
        <div class="modal-footer form-actions">
          <button type="button" class="btn btn-secondary" onclick="hideEventCreationModal()">Cancel</button>
          <button type="submit" class="btn btn-primary post-submit-btn" id="events-submit-btn">
            <span class="submit-text">Create Event</span>
            <span class="submit-loading" style="display: none;">
              <svg class="loading-spinner" viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                  <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                  <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                </animate>
              </circle>
            </svg>
          </span>
        </button>
      </div>
      
      <div id="events-post-creation-message" class="form-message" style="display: none;"></div>
    </form>
  </div>
</div>
</div>
</div>
